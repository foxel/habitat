var serverModule = require("./Server"),
    http = require('http');

(function () {

    function initAgent(name, params) {
        return {
            "module"    : require("./agents/" + name + ".js"),
            "class"     : name,
            "params"    : params
        };
    };

    var mapModule = require("./Map");
    var map = new mapModule.Map();

    map.setSize(40, 30);
    map.map = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,1,1,1,1,1,0],
        [0,0,1,1,1,1,1,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,1,1,1,0],
        [0,0,1,1,1,1,4,4,4,4,4,4,1,1,1,1,1,5,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,4,4,4,4,4,1,0],
        [0,0,1,1,1,1,4,4,5,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,1,5,5,1,4,4,4,4,4,1,0],
        [0,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,1,1,4,4,4,4,1,1,1,0],
        [0,1,1,1,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,4,1,1,1,1,1,0],
        [0,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,4,4,4,4,4,4,1,1,1,1,1,1,0],
        [0,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,1,1,1,1,5,5,1,1,5,5,5,5,1,1,1,1,5,5,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0],
        [0,1,1,5,5,5,1,5,1,1,1,5,5,1,1,1,1,5,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,0,0,0,0,0,0],
        [0,1,1,5,5,1,1,5,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,5,5,1,1,1,1,1,1,1,1,1,1,0,0,0],
        [0,1,1,5,5,1,1,1,1,1,5,1,1,1,1,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,1,1,5,5,1,1,1,1,5,5,1,1,1,1,1,5,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,1,1,1,5,5,1,1,1,1,1,1,5,1,5,5,5,4,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,1,1,0],
        [0,0,1,1,1,5,5,5,1,1,1,5,5,1,1,1,5,5,5,5,5,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,1,1,0],
        [0,0,1,1,5,5,1,5,5,5,1,5,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,1,1,1,1,1,1,1,0],
        [0,0,1,1,1,1,1,1,1,1,1,5,1,1,5,5,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,0],
        [0,0,1,1,5,1,1,1,1,1,5,5,1,1,1,5,5,1,1,1,1,1,1,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,0,1,5,5,5,1,5,1,1,1,5,5,1,5,5,1,1,1,1,1,1,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,1,1,1,1,1,5,1,1,1,1,1,5,1,1,1,1,1,1,1,1,4,4,4,4,1,1,1,1,1,1,1,5,5,1,1,1,1,1,0],
        [0,1,1,1,1,5,5,5,1,1,1,1,5,1,1,1,1,1,1,1,4,4,4,4,1,1,1,1,1,1,5,5,5,5,1,1,1,1,1,0],
        [0,1,5,1,5,5,1,5,1,5,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,5,5,5,1,1,1,1,1,1,1,1,0],
        [0,1,1,5,5,1,1,1,5,1,1,1,1,1,1,1,5,1,1,4,4,4,4,1,1,1,1,5,5,1,1,1,1,1,1,1,1,1,0,0],
        [0,1,1,5,1,1,1,5,5,1,1,1,1,1,1,1,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
        [0,1,1,1,1,5,5,1,1,1,1,1,1,1,5,1,1,1,1,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,0],
        [0,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ];

//    Small test map
//    map.setSize(10, 10);
//    map.map = [
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,1,1,1,0,0,0],
//        [0,0,0,0,1,1,1,0,0,0],
//        [0,0,0,0,1,1,1,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0]
//    ];

    var agents = [
        initAgent("Straight"),
        initAgent("Foxel"),
        initAgent("DummyAgent"),
        initAgent("VeryDummy"),
        initAgent("ReAgent")
    ];

    var srv = new serverModule.Server(agents, map);
    srv.run();
    var observerModule = require('./WebObserver');
    var observer = new observerModule.WebObserver(srv, 8090);
    observer.run();
})();
